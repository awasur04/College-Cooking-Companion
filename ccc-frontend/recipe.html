<html>

<head>
    <title>College Cook Companion</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="College Cook Companion" content="Recipies for those on a budget"/>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>

<body>
    <div id="app">
        <h1>{{ message }}</h1>
        <h1></h1>
        <table v-html="rows" id="app"></table>
        <!-- <button v-on:click="updateMessage()">Update</button> -->
    </div>

    <script>
        var app = new Vue({
            el: '#app',
            data: {
                rows: '',
                recipeNumber: [],
                message: 'College Cooking Companion recipes list',
                recipesReturned: [
                {
                    "id": 647204,
                    "title": "Honey Crescents",
                    "image": "https://spoonacular.com/recipeImages/647204-312x231.jpg",
                    "imageType": "jpg",
                    "usedIngredientCount": 4,
                    "missedIngredientCount": 1,
                    "missedIngredients": [
                        {
                            "id": 19296,
                            "amount": 2.0,
                            "unit": "tablespoons",
                            "unitLong": "tablespoons",
                            "unitShort": "Tbsp",
                            "aisle": "Nut butters, Jams, and Honey",
                            "name": "honey",
                            "original": "2 tablespoons honey",
                            "originalName": "honey",
                            "meta": [],
                            "image": "https://spoonacular.com/cdn/ingredients_100x100/honey.png"
                        }
                    ],
                    "usedIngredients": [
                        {
                            "id": 18375,
                            "amount": 1.0,
                            "unit": "",
                            "unitLong": "",
                            "unitShort": "",
                            "aisle": "Baking",
                            "name": "yeast",
                            "original": "1 sachet dry yeast (7 gr)",
                            "originalName": "sachet dry yeast (7 gr)",
                            "meta": [
                                "dry",
                                "(7 gr)"
                            ],
                            "extendedName": "dry yeast",
                            "image": "https://spoonacular.com/cdn/ingredients_100x100/yeast-granules.jpg"
                        },
                        {
                            "id": 1077,
                            "amount": 250.0,
                            "unit": "mls",
                            "unitLong": "mls",
                            "unitShort": "mls",
                            "aisle": "Milk, Eggs, Other Dairy",
                            "name": "milk",
                            "original": "250 mls lukewarm milk",
                            "originalName": "lukewarm milk",
                            "meta": [
                                "lukewarm"
                            ],
                            "image": "https://spoonacular.com/cdn/ingredients_100x100/milk.png"
                        },
                        {
                            "id": 1001,
                            "amount": 2.0,
                            "unit": "tablespoons",
                            "unitLong": "tablespoons",
                            "unitShort": "Tbsp",
                            "aisle": "Milk, Eggs, Other Dairy",
                            "name": "butter",
                            "original": "2 tablespoons butter",
                            "originalName": "butter",
                            "meta": [],
                            "image": "https://spoonacular.com/cdn/ingredients_100x100/butter-sliced.jpg"
                        },
                        {
                            "id": 1123,
                            "amount": 1.0,
                            "unit": "",
                            "unitLong": "",
                            "unitShort": "",
                            "aisle": "Milk, Eggs, Other Dairy",
                            "name": "egg",
                            "original": "1 egg for brushing",
                            "originalName": "egg for brushing",
                            "meta": [
                                "for brushing"
                            ],
                            "image": "https://spoonacular.com/cdn/ingredients_100x100/egg.png"
                        }
                    ],
                    "unusedIngredients": [],
                    "likes": 1
                }
                ]
            },
            methods: {
                updateMessage() {
                    if(sessionStorage.getItem("free") == "false") {
                        this.rows = "";
                        this.recipesReturned.forEach((i) => {
                            this.addRow(i);
                        })
                        this.addEventListener();
                    } else {
                        this.rows = "";
                        this.getRecipes().forEach((i) => {
                            this.addRow(i);
                        })
                        this.addEventListener();
                    }
                },
                addRow(object) {
                    let r = "<tr>";
                    r += "<td>";
                    r += String(object.title);
                    let imgSrc = object.image;
                    r += "<img src=\"" + imgSrc + "\" />";
                    let recID = object.id;
                    this.recipeNumber.push(recID);
                    r += "</td><td><button ";
                    r += "id=" + String(recID);
                    r += ">Go to</button></td></tr>"; 
                    this.rows += r;
                },
                getRecipes() {
                    return JSON.parse(sessionStorage.getItem("Returned Recipes"));
                    // return this.recipesReturned;

                },
                addEventListener() {
                    const that = this;
                    // TODO This will be buggy
                    window.addEventListener("click" , () =>{ 
                        that.recipeNumber.forEach((i) => {
                            document.getElementById(i).addEventListener("click", ()  => {
                                let recID = String(i);
                                sessionStorage.setItem("LoadRecipe", recID);
                                window.location.href = "SelectedRecipe.html";
                                // TODO Call server localhost:8080/routes/recipes/id with {id: recID}
                            })
                        }) 
                    })
                }
            },
            beforeMount() {
                // this.addRow(sessionStorage.getItem("Returned Recipes")[0])
                    this.updateMessage();
            }
        })
    </script>
</body>

</html>