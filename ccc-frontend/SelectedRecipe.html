<html>

<head>
    <title>College Cook Companion</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="College Cook Companion" content="Recipies for those on a budget"/>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>

<body>
    <div id="app">
    <h1>{{ recipeName }}</h1>
    <button @click="addToFavorites()">Add to favorites</button>
    <h2>Ingredients</h2>
    <table v-html="ingredients" id="app"></table>
    <h2>Instructions</h2>
    <table v-html="instructions" id="app"></table>
    <h2>Nutrition</h2>
    <table v-html="nutrition" id="app"></table>
    <button @click="backToLanding()">Home</button>
    </div>

    <script>

        var app = new Vue({
            el: '#app',
            data: {
                recipeName: "Recipe",
                ingredients: "",
                instructions: '',
                nutrition: "",
                base: {
                    "id": 639492,
    "title": "Cinnamon Twists",
    "image": "https://spoonacular.com/recipeImages/639492-556x370.jpg",
    "ownedIngredients": [
        {
            "id": 18375,
            "name": "active yeast",
            "image": "yeast-granules.jpg",
            "amount": "1 package",
            "currentlyOwned": true
        },
        {
            "id": 1001,
            "name": "butter",
            "image": "butter-sliced.jpg",
            "amount": "1 cup",
            "currentlyOwned": true
        },
        {
            "id": 1123,
            "name": "eggs",
            "image": "egg.png",
            "amount": "2 ",
            "currentlyOwned": true
        },
        {
            "id": 1077,
            "name": "milk",
            "image": "milk.png",
            "amount": "1 cup",
            "currentlyOwned": true
        },
        {
            "id": 2047,
            "name": "salt",
            "image": "salt.jpg",
            "amount": "0.5 teaspoon",
            "currentlyOwned": true
        },
        {
            "id": 19335,
            "name": "sugar",
            "image": "sugar-in-bowl.png",
            "amount": "1 cup",
            "currentlyOwned": true
        }
    ],
    "missingIngredients": [],
    "instructions": [
        "Combine 2 cups flour with yeast.",
        "Heat and stir milk, butter or margarine, sugar and salt until warm and butter is almost completely melted.",
        "Add this  to the flour mixture along with the eggs.Beat with an electric mixer on low speed for 30 seconds, scraping the bowl, then beat on high speed for approx. 3 minutes. Stir in as much of the remaining flour ( 2 to 2 1/3 cups) as you can.Turn out onto a lightly floured surface. Knead in enough remaining flour to make a moderately soft dough that is smooth and elastic (about 3 - 5 minutes). Shape into a ball.",
        "Place in a lightly greased bowl. Cover and let rise in a warm place till double in size. (About 1 hour)Punch dough down. Divide in half. Cover and let rest 10 minutes.",
        "Roll half of the dough into a 12x8 inch rectangle. Melt 3 tablespoons butter or margarine; brush half over the dough. combine 3/4 cup sugar and 2 1/2 teaspoons ground cinnamon; sprinkle half of the mixture over dough. Fold dough in half and then in half once more.",
        "Cut strips of dough along the short end and twist sealing the seams.",
        "Place in a baking sheet. Cover; let rise till nearly double about 30 minutes.",
        "Bake in a 375 degree oven for 20 to 25 minutes. (Be sure to check them, they brown easily.)For the sugar glaze combine 1 cup sifted powdered sugar with 1/4 teaspoon vanilla and 1 tablespoon milk. Continue to add milk 1 teaspoon at a time until you get a drizzling consistency."
    ],
    "nutrition": {
        "Calories": {
            "Amount": "192k",
            "Percent_Of_Daily_Needs": 9.64
        },
        "Fat": {
            "Amount": "14g",
            "Percent_Of_Daily_Needs": 22.08
        },
        "Saturated_Fat": {
            "Amount": "8g",
            "Percent_Of_Daily_Needs": 55.35
        },
        "Carbohydrates": {
            "Amount": "15g",
            "Percent_Of_Daily_Needs": 5.13
        },
        "Sugar": {
            "Amount": "15g",
            "Percent_Of_Daily_Needs": 16.86
        },
        "Cholesterol": {
            "Amount": "59mg",
            "Percent_Of_Daily_Needs": 20
        },
        "Sodium": {
            "Amount": "215mg",
            "Percent_Of_Daily_Needs": 9.38
        },
        "Protein": {
            "Amount": "1g",
            "Percent_Of_Daily_Needs": 3.36
        },
        "Vitamin_A": {
            "Amount": "467IU",
            "Percent_Of_Daily_Needs": 9.35
        },
        "Vitamin_B2": {
            "Amount": "0.09mg",
            "Percent_Of_Daily_Needs": 5.08
        },
        "Vitamin_B1": {
            "Amount": "0.07mg",
            "Percent_Of_Daily_Needs": 4.42
        },
        "Selenium": {
            "Amount": "2µg",
            "Percent_Of_Daily_Needs": 4.09
        },
        "Folate": {
            "Amount": "16µg",
            "Percent_Of_Daily_Needs": 4
        },
        "Vitamin_D": {
            "Amount": "0.6µg",
            "Percent_Of_Daily_Needs": 3.97
        },
        "Phosphorus": {
            "Amount": "34mg",
            "Percent_Of_Daily_Needs": 3.42
        },
        "Vitamin_E": {
            "Amount": "0.45mg",
            "Percent_Of_Daily_Needs": 3.03
        },
        "Calcium": {
            "Amount": "27mg",
            "Percent_Of_Daily_Needs": 2.75
        },
        "Vitamin_B12": {
            "Amount": "0.16µg",
            "Percent_Of_Daily_Needs": 2.7
        },
        "Vitamin_B5": {
            "Amount": "0.25mg",
            "Percent_Of_Daily_Needs": 2.47
        },
        "Zinc": {
            "Amount": "0.2mg",
            "Percent_Of_Daily_Needs": 1.34
        },
        "Vitamin_B6": {
            "Amount": "0.02mg",
            "Percent_Of_Daily_Needs": 1.25
        },
        "Potassium": {
            "Amount": "40mg",
            "Percent_Of_Daily_Needs": 1.16
        },
        "Vitamin_K": {
            "Amount": "1µg",
            "Percent_Of_Daily_Needs": 1.15
        },
        "Vitamin_B3": {
            "Amount": "0.23mg",
            "Percent_Of_Daily_Needs": 1.14
        }
    }
                },
                bluecart: [
    {
        "name": "Great Value Honey, 12 oz Plastic Bear Bottle",
        "description": "<li>100% honey</li><li>Natural sweetener</li><li>Zero calories per serving</li>",
        "image": "https://i5.walmartimages.com/asr/0805991d-0969-4cf7-9f1d-add72d3542e8.f0a9d7b663df6ad3702e64872c483d0c.jpeg?odnHeight=180&odnWidth=180&odnBg=FFFFFF",
        "link": "https://www.walmart.com/ip/Great-Value-Honey-12-oz-Plastic-Bear-Bottle/20647992?athbdg=L1200"
    },
    {
        "name": "Great Value Organic Strained Raw Honey, 16 oz Inverted Plastic Bottle",
        "description": "<li>Natural sweetener</li><li>Great for tea, oatmeal, baked goods, yogurt, cottage cheese and more</li><li>Certified organic</li>",
        "image": "https://i5.walmartimages.com/asr/06ae29ab-9339-49f8-b2ef-96a320fe48fe.17792653f22cbebcccbf13c847d110b8.jpeg?odnHeight=180&odnWidth=180&odnBg=ffffff",
        "link": "https://www.walmart.com/ip/Great-Value-Organic-Strained-Raw-Honey-16-oz-Inverted-Plastic-Bottle/51881464"
    },
    {
        "name": "Great Value Raw Honey, 16 oz Inverted Plastic Bottle",
        "description": "<li>Natural Sweetener</li><li>100% Honey</li><li>Squeeze bottle makes it easy to drizzle on all your favorite foods</li><li>Gluten Free</li>",
        "image": "https://i5.walmartimages.com/asr/38a70aca-79ca-4010-9c84-5707827f455e.18153bd9ca2bb7f70cbc828eb309ef46.jpeg?odnHeight=180&odnWidth=180&odnBg=ffffff",
        "link": "https://www.walmart.com/ip/Great-Value-Raw-Honey-16-oz-Inverted-Plastic-Bottle/433628197"
    },
    {
        "name": "Great Value Organic Strained Raw Honey, 12 oz Inverted Plastic Bottle",
        "description": "<li>Raw organic honey</li><li>Certified kosher</li><li>U.S. Grade A</li>",
        "image": "https://i5.walmartimages.com/asr/0d05e02c-44d3-4fde-9d00-602220b2bc2d.e67d04871c72ece69ff17df5b06f73a9.jpeg?odnHeight=180&odnWidth=180&odnBg=ffffff",
        "link": "https://www.walmart.com/ip/Great-Value-Organic-Strained-Raw-Honey-12-oz-Inverted-Plastic-Bottle/495963399"
    },
    {
        "name": "Local Hive, Raw & Unfiltered, 100% U.S. Midwest Honey Blend, 16oz",
        "description": "<li>100% U.S. Honey</li><li>Straight from the hive, nothing added: nothing removed</li><li>Portion of proceeds from every bottle sold protects pollinators</li>",
        "image": "https://i5.walmartimages.com/asr/9a64d86c-7a0a-428d-aedc-bdd354537acc.4a0ff7ab31ec478adcb18c67c63a8cc9.jpeg?odnHeight=180&odnWidth=180&odnBg=ffffff",
        "link": "https://www.walmart.com/ip/Local-Hive-Raw-Unfiltered-100-U-S-Midwest-Honey-Blend-16oz/46583034"
    },
    {
        "name": "Pure 'N Simple 100% Pure Honey, 80 oz  Plastic Bottle",
        "description": "<div><p class=\"msonormal\"><span style=\"color:black\">? 100% honey with no added ingredients or preservatives</span></p><p class=\"msonormal\"><span style=\"color:black\">? Sweetly robust flavor and aroma</span></p><p class=\"msonormal\"></p></div>",
        "image": "https://i5.walmartimages.com/asr/2ee26b5c-291b-46e2-9ac5-339f8deecbb0_1.5c5575ed46269733d68c806e49316911.jpeg?odnHeight=180&odnWidth=180&odnBg=FFFFFF",
        "link": "https://www.walmart.com/ip/Pure-N-Simple-100-Pure-Honey-80-oz-Plastic-Bottle/19857743"
    }
]

            },
            methods: {
                addToFavorites() {
                    if(sessionStorage.getItem("UUID") == null) {
                        alert("You need to be logged in to save favorites");
                        return;
                    }

                    const data = {
                        id: sessionStorage.getItem("UUID"),
                        savedrecipes: this.base.id
                    }

                    fetch("http://localhost:8080/routes/updateusersavedrecipes", {
                        method: 'PUT',
                        body: JSON.stringify(data),
                        headers: {
                            "Content-Type": "application/json"
                        }
                    })
                    alert("Added " + this.recipeName + " to favorites list");
                    sessionStorage.setItem("newFavorites", this.recipeName);
                },
                backToLanding() {
                    window.location.href = "LandingPage.html";
                }

            },
            beforeMount() {
                const b = {
                    id: sessionStorage.getItem("LoadRecipe")
                }
                fetch("http://localhost:8080/routes/recipes/id", {
                    method: "POST",
                    body: JSON.stringify(b),
                    headers: {
                        "Content-Type": "application/json"
                    }
                }).then(data => data.json())
                .then(data => {
                    console.log(data);
                    this.base = data;
                    this.recipeName = this.base.title;
                    this.base.instructions.forEach((i) => {
                        this.instructions += "<tr><td>";
                        // this.instructions += "<p>";
                        this.instructions += i;
                        // this.instructions += "</p>";
                        this.instructions += "</td></tr>";
                    })
                    this.base.ownedIngredients.forEach((i) => {
                        if(i.name!="honey") {
                            this.ingredients += "<tr><td>";
                            this.ingredients += i.name;
                            this.ingredients += "</td><td>";
                            this.ingredients += i.amount;
                            this.ingredients += "</td></tr>";
                        } else {
                            this.ingredients += "<tr><td>";
                            this.ingredients += "<a href=" + this.bluecart[0].link + ">" + i.name + "</a>";
                            this.ingredients += "</td><td>";
                            this.ingredients += i.amount;
                            this.ingredients += "</td></tr>"; 
                        }

                    })
                    this.base.missingIngredients.forEach((i) => {
                        console.log("Missing ingredient ");
                        console.log(i);
                        const missedIngredient = {
                            items: i.name
                        }
                        fetch("http://localhost:8080/routes/recipes/id", {
                            method: "GET",
                            body: JSON.stringify(missedIngredient),
                            headers: {
                                "Content-Type": "application/json"
                            }
                        }).then(shopping => shopping.json())
                        .then(shopping => {
                            this.ingredients += "<tr><td>";
                            this.ingredients += "<a href=" + shopping.link + ">" + i.name + "</a>";
                            this.ingredients += "</td><td>";
                            this.ingredients += i.amount;
                            this.ingredients += "</td></tr>";
                            
                        })
                    })
                    this.nutrition += "<tr><td>Calories</td><td>" + this.base.nutrition.Calories.Amount + "</td></tr>";
                    this.nutrition += "<tr><td>Fat</td><td>" + this.base.nutrition.Fat.Amount + "</td></tr>";
                    this.nutrition += "<tr><td>Staturated Fat</td><td>" + this.base.nutrition.Saturated_Fat.Amount + "</td></tr>";
                    this.nutrition += "<tr><td>Carbohydrates</td><td>" + this.base.nutrition.Carbohydrates.Amount + "</td></tr>";
                    this.nutrition += "<tr><td>Sugar</td><td>" + this.base.nutrition.Sugar.Amount + "</td></tr>";
                    this.nutrition += "<tr><td>Cholesterol</td><td>" + this.base.nutrition.Cholesterol.Amount + "</td></tr>";
                    this.nutrition += "<tr><td>Sodium</td><td>" + this.base.nutrition.Sodium.Amount + "</td></tr>";
                    this.nutrition += "<tr><td>Protein</td><td>" + this.base.nutrition.Protein.Amount + "</td></tr>";
                    this.nutrition += "<tr><td>Vitamin A</td><td>" + this.base.nutrition.Vitamin_A.Amount + "</td></tr>";
                })
                
            }
        })
    </script>
</body>
</html>